<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-left">
      <h1>Admin Dashboard - Reservierungsübersicht</h1>
      <span class="last-update">Zuletzt aktualisiert: {{ formatTime(lastUpdate().toISOString()) }}</span>
    </div>
    <div class="header-actions">
      <button class="btn-refresh" (click)="loadData()" [disabled]="loading()">
        {{ loading() ? '↻ Lädt...' : '↻ Aktualisieren' }}
      </button>
      <button class="btn-logout" (click)="logout()">Abmelden</button>
    </div>
  </header>

  <!-- Nachrichten -->
  @if (errorMessage()) {
    <div class="alert alert-error">{{ errorMessage() }}</div>
  }
  
  @if (successMessage()) {
    <div class="alert alert-success">{{ successMessage() }}</div>
  }

  <!-- Loading -->
  @if (loading()) {
    <div class="loading">Lädt Reservierungen...</div>
  }

  <!-- Reservierungsliste -->
  @if (!loading() && reservationsByDate().length > 0) {
    <div class="reservations-container">
      @for (dateGroup of reservationsByDate(); track dateGroup[0]) {
        <div class="date-section">
          <h2 class="date-header">{{ dateGroup[0] }}</h2>
          
          <div class="reservations-grid">
            @for (reservation of dateGroup[1]; track reservation.id) {
              <div class="reservation-card">
                <div class="reservation-header">
                  <span class="table-name">{{ reservation.tableName }}</span>
                  <span class="time">{{ formatTime(reservation.startTime) }} - {{ calculateEndTime(reservation.startTime, reservation.durationMinutes) }}</span>
                </div>
                
                <div class="reservation-body">
                  <div class="info-row">
                    <span class="label">Kunde:</span>
                    <span class="value">{{ reservation.customerName }}</span>
                  </div>
                  
                  <div class="info-row">
                    <span class="label">Dauer:</span>
                    <span class="value">{{ reservation.durationMinutes }} Minuten</span>
                  </div>
                </div>
                
                <div class="reservation-actions">
                  <button 
                    class="btn-details" 
                    (click)="viewDetails(reservation)">
                    Details
                  </button>
                  <button 
                    class="btn-delete" 
                    (click)="deleteReservation(reservation)">
                    Löschen
                  </button>
                </div>
              </div>
            }
          </div>
        </div>
      }
    </div>
  }

  <!-- Keine Reservierungen -->
  @if (!loading() && reservationsByDate().length === 0) {
    <div class="no-reservations">
      <p>Keine aktiven Reservierungen vorhanden.</p>
    </div>
  }

  <!-- Details Modal -->
  @if (selectedReservation()) {
    <div class="modal-overlay" (click)="closeDetails()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Reservierungsdetails</h2>
          <button class="btn-close" (click)="closeDetails()">✕</button>
        </div>
        
        <div class="modal-body">
          <div class="detail-row">
            <span class="detail-label">Tisch:</span>
            <span class="detail-value">{{ selectedReservation()!.tableName }}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Datum:</span>
            <span class="detail-value">{{ formatDate(selectedReservation()!.startTime) }}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Startzeit:</span>
            <span class="detail-value">{{ formatTime(selectedReservation()!.startTime) }}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Endzeit:</span>
            <span class="detail-value">{{ calculateEndTime(selectedReservation()!.startTime, selectedReservation()!.durationMinutes) }}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Dauer:</span>
            <span class="detail-value">{{ selectedReservation()!.durationMinutes }} Minuten</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Kundenname:</span>
            <span class="detail-value">{{ selectedReservation()!.customerName }}</span>
          </div>
          
          @if (selectedReservation()!.customerEmail) {
            <div class="detail-row">
              <span class="detail-label">E-Mail:</span>
              <span class="detail-value">{{ selectedReservation()!.customerEmail }}</span>
            </div>
          }
          
          @if (selectedReservation()!.customerPhone) {
            <div class="detail-row">
              <span class="detail-label">Telefon:</span>
              <span class="detail-value">{{ selectedReservation()!.customerPhone }}</span>
            </div>
          }
          
          @if (selectedReservation()!.status) {
            <div class="detail-row">
              <span class="detail-label">Status:</span>
              <span class="detail-value">{{ selectedReservation()!.status }}</span>
            </div>
          }
        </div>
        
        <div class="modal-footer">
          <button class="btn-delete-modal" (click)="deleteReservation(selectedReservation()!)">
            Reservierung löschen
          </button>
          <button class="btn-cancel" (click)="closeDetails()">
            Schließen
          </button>
        </div>
      </div>
    </div>
  }
</div>
